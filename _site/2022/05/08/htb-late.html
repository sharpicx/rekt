<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HackTheBox: Late | sharpicx</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="HackTheBox: Late" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="it’s been a while man, i haven’t written on this blog and finally saya mulai menulis kembali, saya sampai lupa kalau saya sendiri punya blog yang mungkin harus diisi berapa tahun sekali. jadi di blog kali ini hanya writeup untuk mesin Late. dengan kategori easy lagi untuk memenuhi tulisan-tulisan yang ada di blog ini. sebenarnya ingin sekali saya menulis blog disini menggunakan bahasa inggris ye kan. tapi saya liat lagi dari niat awal saya menulis disini memang saya set ke indonesia, untuk mengenalkan red-teaming / pentesting ke orang-orang yang ingin terjun. walaupun memang di indonesia sendiri banyak suhu hehehe." />
<meta property="og:description" content="it’s been a while man, i haven’t written on this blog and finally saya mulai menulis kembali, saya sampai lupa kalau saya sendiri punya blog yang mungkin harus diisi berapa tahun sekali. jadi di blog kali ini hanya writeup untuk mesin Late. dengan kategori easy lagi untuk memenuhi tulisan-tulisan yang ada di blog ini. sebenarnya ingin sekali saya menulis blog disini menggunakan bahasa inggris ye kan. tapi saya liat lagi dari niat awal saya menulis disini memang saya set ke indonesia, untuk mengenalkan red-teaming / pentesting ke orang-orang yang ingin terjun. walaupun memang di indonesia sendiri banyak suhu hehehe." />
<link rel="canonical" href="http://localhost:4000/2022/05/08/htb-late" />
<meta property="og:url" content="http://localhost:4000/2022/05/08/htb-late" />
<meta property="og:site_name" content="sharpicx" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-08T00:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HackTheBox: Late" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-08T00:00:00+07:00","datePublished":"2022-05-08T00:00:00+07:00","description":"it’s been a while man, i haven’t written on this blog and finally saya mulai menulis kembali, saya sampai lupa kalau saya sendiri punya blog yang mungkin harus diisi berapa tahun sekali. jadi di blog kali ini hanya writeup untuk mesin Late. dengan kategori easy lagi untuk memenuhi tulisan-tulisan yang ada di blog ini. sebenarnya ingin sekali saya menulis blog disini menggunakan bahasa inggris ye kan. tapi saya liat lagi dari niat awal saya menulis disini memang saya set ke indonesia, untuk mengenalkan red-teaming / pentesting ke orang-orang yang ingin terjun. walaupun memang di indonesia sendiri banyak suhu hehehe.","headline":"HackTheBox: Late","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2022/05/08/htb-late"},"url":"http://localhost:4000/2022/05/08/htb-late"}</script>
<!-- End Jekyll SEO tag -->


<meta name="keywords" content="SSTI,linux-permission,flask" />

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" href="/favicon.ico"/>
<link rel="alternate" type="application/rss+xml" title="sharpicx - linux & cybersecurity big fan " href="/feed.xml" />
<link rel="stylesheet" type="text/css" href="/assets/css/base.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/highlight.css" />
<!-- <link rel="stylesheet" href="https://hackerthemes.com/bootstrap-themes/demo/theme-machine/neon-glow/css/bootstrap4-neon-glow.min.css"> -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

<!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->


<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async ></script>


<script src="/assets/script/jekyllpaper.js" async ></script>
<script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js" onload="javascript:loadMermaid();" async></script>


</head>
<body>
  <div class="container-wrapper">
    <header class="container-header">
      <div class="header-info">
  <span class="header-info-name">sharpicx</span><br/>
  <span class="header-info-desc" style="padding-left: 25px">linux & cybersecurity big fan </span>
</div>
<nav class="header-nav">
  <ul class="header-main-nav">
  
    <li class="header-main-nav-item"><a href="/">home</a></li>
  
    <li class="header-main-nav-item"><a href="/category">categories</a></li>
  
    <li class="header-main-nav-item"><a href="/about">whoami</a></li>
  
  </ul>
</nav>

    </header>
    <main class="container-main">
      <article class="container-post">
  <div class="post-title" style="padding: 0px 0px 20px 0px">
    <h1>HackTheBox: Late</h1>
  </div>
  <div class="post-author">
    <span>sharpicx</span>
  </div>
  <div class="post-content">
    <p>it’s been a while man, i haven’t written on this blog and finally saya mulai menulis kembali, saya sampai lupa kalau saya sendiri punya blog yang mungkin harus diisi berapa tahun sekali.
jadi di blog kali ini hanya writeup untuk mesin <a href="https://www.hackthebox.com/home/machines/profile/463">Late</a>. dengan kategori <strong>easy</strong> lagi untuk memenuhi tulisan-tulisan yang ada di blog ini.
sebenarnya ingin sekali saya menulis blog disini menggunakan bahasa inggris ye kan. tapi saya liat lagi dari niat awal saya menulis disini memang saya set ke indonesia, untuk mengenalkan
red-teaming / pentesting ke orang-orang yang ingin terjun. walaupun memang di indonesia sendiri banyak suhu hehehe.</p>

<h2 id="recon">Recon</h2>
<p>apapun itu saya pasti mengawali boot2root dengan reconnaisance menggunakan <strong>rustscan</strong>.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 02:5e:29:0e:a3:af:4e:72:9d:a4:fe:0d:cb:5d:83:07 <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDSqIcUZeMzG+QAl/4uYzsU98davIPkVzDmzTPOmMONUsYleBjGVwAyLHsZHhgsJqM9lmxXkb8hT4ZTTa1azg4JsLwX1xKa8m+RnXwJ1DibEMNAO0vzaEBMsOOhFRwm5IcoDR0gOONsYYfz18pafMpaocitjw8mURa+YeY21EpF6cKSOCjkVWa6yB+GT8mOcTZOZStRXYosrOqz5w7hG+20RY8OYwBXJ2Ags6HJz3sqsyT80FMoHeGAUmu+LUJnyrW5foozKgxXhyOPszMvqosbrcrsG3ic3yhjSYKWCJO/Oxc76WUdUAlcGxbtD9U5jL+LY2ZCOPva1+/kznK8FhQN
|   256 41:e1:fe:03:a5:c7:97:c4:d5:16:77:f3:41:0c:e9:fb <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBMen7Mjv8J63UQbISZ3Yju+a8dgXFwVLgKeTxgRc7W+k33OZaOqWBctKs8hIbaOehzMRsU7ugP6zIvYb25Kylw<span class="o">=</span>
|   256 28:39:46:98:17:1e:46:1a:1e:a1:ab:3b:9a:57:70:48 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIGrWbMoMH87K09rDrkUvPUJ/ZpNAwHiUB66a/FKHWrj
80/tcp open  http    syn-ack nginx 1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-favicon: Unknown favicon MD5: 1575FDF0E164C3DB0739CF05D9315BDF
| http-methods: 
|_  Supported Methods: GET HEAD
|_http-title: Late - Best online image tools
|_http-server-header: nginx/1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

</code></pre></div></div>
<p>result diatas menghasilkan 2 port antara lain:</p>
<ul>
  <li>22, SSH.</li>
  <li>80, HTTP dengan nginx server dari sistem operasi <em>Ubuntu</em>.</li>
</ul>

<h2 id="80---http-static-site">80 - http static site</h2>
<p><img src="https://i.ibb.co/vYrP2NT/page1.png" alt="gambar" /></p>

<p>okay, dari gambar sendiri sudah terlihat bahwa website ini seperti menyediakan fitur photo editor, cukup menarik.
sebelum itu, kita tambahkan terlebih dahulu domain <strong>late.htb</strong> ke file host <strong>/etc/hosts</strong> agar lebih efisien.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'10.10.11.156 late.htb'</span> <span class="o">&gt;&gt;</span> /etc/hosts
</code></pre></div></div>

<h2 id="discovering-web-content">discovering web-content.</h2>
<p>dari result dibawah ini</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/assets               (Status: 301) [Size: 194] [--&gt; http://late.htb/assets/]
/contact.html         (Status: 200) [Size: 6364]                             
/index.html           (Status: 200) [Size: 9461]  
</code></pre></div></div>
<p>terlihat senseless and we should go to the next part.</p>

<h2 id="subdomain-fuzzing">subdomain fuzzing</h2>
<p>sebenarnya metode ini tidak perlu dilakukan karena pada segmen <strong>FAQ</strong> kita diredireksikan ke subdomain <strong>images.late.htb</strong>.
tanpa perlu buang-buang waktu, itu sudah sangat jelas valid. tapi saya gini-gini juga ingin menambahkan sub-bab agar tambah menarik.</p>

<p><img src="https://i.ibb.co/gdDQxGr/image.png" alt="gambar2" /> <br />
<em>shoutout to <a href="https://www.hackthebox.com/home/users/profile/532180">@lordrukie</a> for helping me to fix up this this problem.</em></p>

<p>yap karena sudah valid maka kita tambahkan virtualhost (<strong>images.late.htb</strong>) tersebut ke <strong>/etc/hosts</strong>.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'10.10.11.156 images.late.htb'</span> <span class="o">&gt;&gt;</span> /etc/hosts
</code></pre></div></div>

<h2 id="imageslatehtb">images.late.htb</h2>

<p><img src="https://i.ibb.co/514fVtF/page2.png" alt="gambar3" /></p>

<p>terlihat seperti upload form, (ya memang upload form sat). dari teks deskripsi tepat dibawah judul sudah terbaca bahwasanya jika ingin mengalihkan image ke dokumen teks, gunakan tools ini saja. walaupun kaidah 
terjemah aslinya tidak seperti itu, ya memang tidak saya esensialkan cuma biar pas aja gitu ah ga seru dih. <br />
tepat di samping kanan judul terdapat tulisan <strong>flask</strong>. saya coba analisa dengan extension wappalyzer.</p>

<p><img src="https://i.ibb.co/4Km6ZGR/image.png" alt="gambar4" /></p>

<p>ternyata tidak tercantum, mungkin ini service yang ada dalam web-server.<br />
Apa itu <strong>Flask</strong>? Jika dari <a href="https://en.wikipedia.org/wiki/Flask_(web_framework)">Wikipedia</a> ini jawabannya.</p>

<blockquote>
  <p>Flask is a micro web framework written in Python. It is classified as a microframework because it does not require particular tools or libraries. It has no database abstraction layer, form validation, or any other components where pre-existing third-party libraries provide common functions. However, Flask supports extensions that can add application features as if they were implemented in Flask itself. Extensions exist for object-relational mappers, form validation, upload handling, various open authentication technologies and several common framework related tools.</p>
</blockquote>

<p>Oh, ternyata sebuah <em>microframework</em> terbuat dari <em>Python</em>. berarti dari sini saya sudah berfikir bahwa tidak bisa untuk upload shell berformat <em>PHP</em>. akankah sangat konyol, web-server dari python mengeksekusi file berformat <em>PHP</em>. hanya orang bodoh yang mencoba hal ini, tapi apa salahnya mencoba jika estimasi tidak akuratpun tak apa.</p>

<p><img src="https://i.ibb.co/yQM260c/image.png" alt="gambar5" /></p>

<p>Jika mengutip dari <strong>Wikipedia</strong>. dari nama-nama kompenen diatas, masih sangat familiar dengan <strong>SSTI</strong> (<em>Server-side Template Injection</em>) untuk dicoba. Tapi dari sisi mana saya harus mencoba? pikir saya saat sedang frustasi karena stuck pada upload shell berformat PHP tadi dan kewalahan
karena saya lupa kalo visi dari website ini adalah untuk membantu mengonversi image ke text.</p>

<h2 id="server-side-template-injection">Server-side Template Injection</h2>
<p>Saya coba semua payload dari jenis apapun, yang ada pada <a href="#referensi">hacktricks</a>, menggunakan render dari <a href="#referensi">google fonts</a> yang discreenshot menggunakan <em>flameshot</em> lalu disave dengan format <em>png</em>.</p>

<p><img src="https://i.ibb.co/tchmt5b/ssti.png" alt="gambar6" /></p>

<p>hasilnya seperti gambar dibawah ini, jika termultiplikasikan maka proses injeksi berfungsi.</p>

<p><img src="https://i.ibb.co/wrxV9Zh/image.png" alt="gambar7" /></p>

<p>lalu saya coba lagi dengan payload dibawah ini, jika eksekusi berhasil maka output yang didapat akan berbeda.</p>

<p><img src="https://i.ibb.co/1ZtbhZz/ssti.png" alt="gambar8" /></p>

<p>And yas! we got the result we’ve been looking for</p>

<p><img src="https://i.ibb.co/5xwDqDN/image.png" alt="gambar9" /></p>

<h2 id="shell-as-svc">shell as svc</h2>

<p>Karena tadi saya bisa mendapatkan sebuah output dari command <em>‘id’</em> sebagai request dari injeksi. maka kali ini saya akan mencoba untuk mengambil <strong>id_rsa</strong> dari user tersebut. dengan payload dibawah ini</p>

<p><img src="https://i.ibb.co/CH3F7fL/ssti.png" alt="gambar10" /> <br />
And boom, we got the <strong>id_rsa</strong> key to get connected to ssh.</p>

<p><img src="https://i.ibb.co/CtgHZ5y/image.png" alt="gambar11" />.</p>

<p>langsung konek, dan yap we got the user flag.</p>

<p><img src="https://i.ibb.co/c1jPvdc/image.png" alt="gambar12" /></p>

<h2 id="shell-as-root">shell as root</h2>

<p>karena di $HOME path ada <em>linpeas</em> entah ini punya siapa atau memang bekasan saya saat sedang main. yang terpenting ialah memakainya saja.</p>
<blockquote>
  <p>linPEAS adalah sebuah automated script yang dibuat oleh Carlos P. ini juga dibuat dengan sebuah objek sederhana untuk mengenumerasi semua jalan yang memungkinkan atau metode untuk ekskalasi pada linux system.</p>
</blockquote>

<p>saat saya eksekusi, saya tidak menemukan hal yang menarik pada linPEAS. mari kita coba cek proses dengan menggunakan automated-script ternama yaitu, <strong>pspy</strong>.
and, ketika saya login pake ssh lagi dengan terminal yang lain suddenly saya menemukan random script dengan <strong>UID=0</strong> who runs the script.</p>

<p><img src="https://i.ibb.co/pv52jyD/image.png" alt="gambar13" /></p>

<p>saat saya cek permissionnya, ternyata kita bisa overwrite pada script tersebut tanpa naik privilege. lalu saya berinisiatif untuk hijack <strong>bash</strong> dari root dengan command dibawah ini.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"cp /bin/bash /tmp/bash &amp;&amp; chmod +s /tmp/bash"</span> <span class="o">&gt;&gt;</span> /usr/local/sbin/ssh-alert.sh
</code></pre></div></div>
<p>lalu saat saya re-log ssh, dan saya pergi ke directory <strong>/tmp</strong>. dan menjalankan bash dengan command <strong>-p</strong> untuk elevasi privilege.</p>

<p><img src="https://i.ibb.co/68XVxzb/image.png" alt="gambar14" /></p>

<p>and we have rooted.</p>

<h2 id="referensi">Referensi</h2>
<ul>
  <li><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection</a></li>
  <li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md</a></li>
  <li><a href="https://fonts.google.com">https://fonts.google.com</a></li>
  <li><a href="https://github.com/nikssardana/flaskOcr">https://github.com/nikssardana/flaskOcr</a></li>
</ul>

  </div>
  <div class="post-info" style="padding-top: 25px">
    <div class="post-date">
      2022-05-08.
    </div>
    <div class="post-categories">
      <span></span>
      
      <a href="/category/hackthebox" class="post-category">hackthebox</a>
      
    </div>
    <div class="post-tags">
      <span></span>
      
      <a href="/tag/ssti" class="post-tag">SSTI</a>
      
      <a href="/tag/linux-permission" class="post-tag">linux-permission</a>
      
      <a href="/tag/flask" class="post-tag">flask</a>
      
    </div>
    <div class="post-tools">
      
      <div>
        <span></span><a href="/2022/05/16/hmv-system">HackMyVM: System</a>
      </div>
      
      
      <div>
        <span></span><a href="/2022/05/01/hmv-ephemeral2">HackMyVM: Ephemeral 2</a>
      </div>
      
    </div>
    
  </div>
</article>

    </main>
    <footer class="container-footer">
      <div class="footer-copyright">
  <span class="footer-copyright-text float-left">Copyright &copy; 2022.  sharpicx.</span>
  <span class="footer-copyright-text float-right">
    Powered by <a href="https://jekyllrb.com/">Jekyll</a>
  </span>
</div>

    </footer>
  </div>
</body>
</html>